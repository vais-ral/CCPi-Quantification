cmake_minimum_required(VERSION 2.8.8 FATAL_ERROR)

PROJECT(CCPiNexusWidget)

IF(NOT JNI_FOUND)
FIND_PACKAGE(Qt4 REQUIRED)

# back up any user-defined HDF5_DIR setting
set(_SAVED_HDF5_DIR ${HDF5_DIR})
FIND_PACKAGE(HDF5 NO_MODULE) # First look for hdf5-config.cmake in defined locations. This file is generated by HDF5 team and is likely more up to date than FindHDF5.cmake included in CMake.
IF(NOT HDF5_FOUND)
 # didn't find hdf5-config.cmake. Need to fall back on CMake's built-in FindHDF5.cmake logic.
 # required says we fail if it isn't found.
 # Restore the value reset by the previous call to 'find_package(HDF5 "1.8.5" NO_MODULE)'
 set(HDF5_DIR ${_SAVED_HDF5_DIR} CACHE PATH "HDF5 install dir" FORCE)
 FIND_PACKAGE(HDF5 REQUIRED)
ENDIF()

SET(CCPiNexusWidget_SOURCES CCPiNexusTreeModel.cpp CCPiNexusTreeItem.cpp CCPiNexusWidgetDialog.cpp CCPiNexusReader.cpp)
SET(CCPiNexusWidget_HEADERS CCPiNexusTreeModel.h CCPiNexusWidgetDialog.h)
SET(CCPiNexusWidget_FORMS CCPiNexusWidget.ui)

QT4_WRAP_CPP(CCPiNexusWidget_HEADERS_MOC ${CCPiNexusWidget_HEADERS})
QT4_WRAP_UI(CCPiNexusWidget_FORMS_HEADERS ${CCPiNexusWidget_FORMS})

INCLUDE(${QT_USE_FILE})
ADD_DEFINITIONS(${QT_DEFINITIONS})

FIND_PACKAGE(HDF5 REQUIRED)
INCLUDE_DIRECTORIES(../ ${HDF5_INCLUDE_DIR} ${CMAKE_CURRENT_BINARY_DIR})

ADD_LIBRARY(CCPiNexusWidget ${CCPiNexusWidget_SOURCES} 
				${CCPiNexusWidget_FORMS_HEADERS} 
				${CCPiNexusWidget_HEADERS_MOC})
TARGET_LINK_LIBRARIES(CCPiNexusWidget ${QT_LIBRARIES}  ${HDF5_LIBRARIES})
SUBDIRS(test)
ELSE()
#FIND_PACKAGE(HDF5 REQUIRED)
#INCLUDE_DIRECTORIES(../ ${HDF5_INCLUDE_DIR} ${CMAKE_CURRENT_BINARY_DIR})
#ADD_LIBRARY(CCPiNexusWidget CCPiNexusReader.cpp)
#TARGET_LINK_LIBRARIES(CCPiNexusWidget ${HDF5_LIBRARIES})
ENDIF()
